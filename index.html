<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aplikasi Kasir ESC/POS</title>
  <style>
    body {font-family: Arial, sans-serif;margin: 0;padding: 15px;background: #f8f9fa;color: #111;}
    h2 {text-align: center;margin-bottom: 15px;}
    .card {background: #fff;padding: 12px;border-radius: 12px;box-shadow: 0 2px 6px rgba(0,0,0,0.1);margin-bottom: 12px;position: relative;}
    input, button {width: 90%;padding: 10px;margin-top: 6px;border: 1px solid #ccc;border-radius: 4px;font-size: 15px;}
    button {background: #2563eb;color: #fff;font-weight: bold;border: none;cursor: pointer;}
    button:active {background: #1e40af;}
    table {width: 100%;margin-top: 10px;border-collapse: collapse;font-size: 14px;}
    th, td {padding: 8px;border-bottom: 1px solid #ddd;text-align: left;vertical-align: top;}
    .total {text-align: right;font-weight: bold;margin-top: 10px;}
    .suggestions {position: absolute;top: 65px;left: 0;right: 0;background: #fff;border: 1px solid #ccc;border-radius: 8px;max-height: 250px;overflow-y: auto;z-index: 10;display: none;}
    .suggestion-item {padding: 8px;border-bottom: 1px solid #eee;font-size: 20px;}
    .nama-produk {font-weight: bold;margin-bottom: 4px;}
    .harga-info {font-size: 17px;color: #6b7280;margin-bottom: 4px;}
    .isi-info {font-size: 12px;color: #9ca3af;margin-bottom: 6px;}
    .btn-pilih {display: inline-block;padding: 4px 8px;margin-right: 50px;border-radius: 6px;font-size: 20px;cursor: pointer;color: #fff;}
    .btn-dos {background: #16a34a;}
    .btn-ecer {background: #2563eb;}
    .qty-control {display: flex;align-items: center;justify-content: center;gap: 5px;}
    .btn-qty {background: #e5e7eb;border: none;padding: 10px 6px;border-radius: 6px;font-size: 14px;cursor: pointer;}
    .title-bar {display: flex;justify-content: space-between;align-items: center;}
    /* Modal Riwayat */
    .modal {
      display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;
    }
    .modal-content {
      background: #fff; padding: 15px; border-radius: 10px; max-width: 600px; width: 95%; max-height: 80%;
      overflow-y: auto;
    }
    .modal-header { display: flex; justify-content: space-between; align-items: center; }
    .modal-header h3 { margin: 0; }
    .aksi-btn {padding:4px 8px;margin:2px;border:none;border-radius:6px;font-size:12px;cursor:pointer;}
    .edit-btn {background:#16a34a;color:#fff;}
    .hapus-btn {background:#dc2626;color:#fff;}
  </style>
</head>
<body>
  <h2>WPA SHOP GROSIR</h2>

  <div class="card">
    <input type="text" id="cariProduk" placeholder="Cari produk (Nama/ID)" oninput="cariProduk()">
    <div id="suggestions" class="suggestions"></div>
  </div>

  <div class="card">
    <div class="title-bar"><h3>Keranjang</h3></div>
    <table id="keranjang">
      <thead>
        <tr>
          <th>Produk</th>
          <th>Qty</th>
          <th>Subtotal</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="total">Total: Rp <span id="total">0</span></div>
    <input type="number" id="uangPembeli" placeholder="Uang Pembeli" oninput="hitungKembalian()">
    <div class="total">Kembalian: Rp <span id="kembalian">0</span></div>
    <button onclick="cetakNota()">Cetak Nota</button>
  </div>

  <div class="card">
    <button onclick="bukaRiwayat()">Riwayat Orderan</button>
  </div>

  <!-- Modal Riwayat -->
  <div id="riwayatModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Riwayat Orderan</h3>
        <button onclick="tutupRiwayat()">X</button>
      </div>
      <table id="tabelRiwayat">
        <thead>
          <tr>
            <th>Tanggal</th>
            <th>Total</th>
            <th>Detail</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

<script>
  const produkDB = [
    {id: "8998866109222", nama: "Barakat pasta gigi 75gr", grosir: 3000, ecer: 3000, satuan: "1 Pcs", isi: "1 Pcs"},
  {id: "Prtxu5", nama: "Protex ungu 5p", grosir: 109000, ecer: 2400, satuan: "dos", isi: "48 pak"},
  {id: "Rkyt800", nama: "Minyak rakyat 800ml", grosir: 178000, ecer: 15000, satuan: "dos", isi: "12 botol"},
  {id: "Grm", nama: "Garam senyum 250gr", grosir: 27000, ecer: 1500, satuan: "slop", isi: "20 bks"},
  {id: "Grmjmpl", nama: "Garam jempol 200gr", grosir: 22000, ecer: 1300, satuan: "slop", isi: "20 bks"},
  {id: "Ichioch", nama: "Ichi ocha", grosir: 50000, ecer: 2500, satuan: "dos", isi: "24 botol"},
  {id: "Pck", nama: "Teh pucuk", grosir: 58000, ecer: 2500, satuan: "dos", isi: "24 botol"},
  {id: "Aqv700", nama: "Aquviva 700ml", grosir: 20000, ecer: 2000, satuan: "slop", isi: "12 botol"},
  {id: "Thrio", nama: "Teh rio", grosir: 19000, ecer: 19000, satuan: "dos", isi: "24 cup"},
  {id: "Mkmkl3", nama: "Moko moko L3", grosir: 104000, ecer: 4500, satuan: "dos", isi: "24 pack"},
  {id: "Djsmsurfl", nama: "Dji sam soe refil 12", grosir: 214000, ecer: 21500, satuan: "slop", isi: "10 bks"},
  {id: "Dsskrtk12", nama: "Dji sam soe 12 kretek", grosir: 186000, ecer: 19000, satuan: "slop", isi: "10 bks"},
  {id: "Kp1kg", nama: "Kopi mentah 1kg", grosir: 64000, ecer: 64000, satuan: "Kg", isi: "1kg"},
  {id: "Kp500", nama: "Kopi mentah 500gr", grosir: 32500, ecer: 32500, satuan: "500gr", isi: "500gr"},
  {id: "Kp250gr", nama: "Kopi mentah 250gr", grosir: 16500, ecer: 16500, satuan: "250gr", isi: "250gr"},
{id: "Tmbr", nama: "Tumbar", grosir: 24000, ecer: 2500, satuan: "kg", isi: "1 kg"},
  {id: "Mrca", nama: "Merica", grosir: 165000, ecer: 17000, satuan: "Kg", isi: "1kg"},
  {id: "Rptor", nama: "Raptor kretek", grosir: 80000, ecer: 8500, satuan: "slop", isi: "10 bks"},
  {id: "Fntkcl", nama: "Fanta kecil", grosir: 32000, ecer: 3000, satuan: "slop", isi: "12 botol"},
  {id: "Pcr350ml", nama: "Pocari sweat 350ml", grosir: 126000, ecer: 5500, satuan: "dos", isi: "24 botol"},
  {id: "Adesrcku", nama: "Adem sari chingku", grosir: 140000, ecer: 6000, satuan: "dos", isi: "24 kaleng"},
  {id: "Wpc780", nama: "Wpc 780ml", grosir: 68500, ecer: 11500, satuan: "dos", isi: "6 botol"},
  {id: "Trdpdg", nama: "Terigu dua pedang", grosir: 169000, ecer: 7000, satuan: "Sak", isi: "25 kg"},
  {id: "Pwrfu", nama: "Power f ungu", grosir: 20000, ecer: 20000, satuan: "dos", isi: "24 pcs"},
  {id: "Pdms2k", nama: "Padimas 2000", grosir: 99000, ecer: 1750, satuan: "dos", isi: "62 pcs"},
  {id: "Drms", nama: "Doro mas", grosir: 37000, ecer: 37000, satuan: "Bal", isi: "44 biji"},
{id: "Ekclk", nama: "Ekonomi colek", grosir: 50000, ecer: 1700, satuan: "dos", isi: "30 pcs"},
{id: "Ka150g", nama: "Kapal api 150gr", grosir: 421000, ecer: 21500, satuan: "dos", isi: "20 pcs"},
  {id: "Extrjs", nama: "Extrajoss", grosir: 65500, ecer: 13500, satuan: "slop", isi: "5 pak"},
  {id: "Tpsgtga", nama: "Tp segitiga kemasan", grosir: 128000, ecer: 11000, satuan: "dos", isi: "12 pcs"},
  {id: "Ldaku", nama: "Ladaku", grosir: 59000, ecer: 10000, satuan: "Pak", isi: "6 rtg"},
  {id: "Hmjrg", nama: "Hemaviton jreng", grosir: 80500, ecer: 8500, satuan: "Slop", isi: "10 kotak"},
  {id: "Frtius", nama: "Fortius", grosir: 67000, ecer: 2500, satuan: "dos", isi: "30 pak"},
  {id: "Lwkhm", nama: "Luwak hitam mini 6.5gr", grosir: 180000, ecer: 8500, satuan: "dos", isi: "20 rtg"},
  {id: "Mi3aym", nama: "Mie 3 ayam", grosir: 37000, ecer: 1700, satuan: "dos", isi: "24 pcs"},
  {id: "Kaspmx", nama: "Kapal api mix", grosir: 197000, ecer: 17000, satuan: "dos", isi: "12 rtg"},
{id: "Mskaym", nama: "Masako ayam", grosir: 260000, ecer: 4500, satuan: "dos", isi: "60 rtg"},
  {id: "Msksp", nama: "Masako sapi", grosir: 260000, ecer: 4500, satuan: "dos", isi: "60 rtg"},
  {id: "eml400", nama: "Emeron lovely 400ml", grosir: 93000, ecer: 8000, satuan: "dos", isi: "12 pcs"},
  {id: "pshdlrt", nama: "Posh deo lotion rtg", grosir: 196500, ecer: 16500, satuan: "dos", isi: "12 rtg"},
  {id: "2kcpbx", nama: "Kecap sedap 2rtg+box", grosir: 79000, ecer: 10500, satuan: "dos", isi: "16 rtg"},
  {id: "kcsprg", nama: "Kecap sedap + piring", grosir: 348000, ecer: 20500, satuan: "dos", isi: "12 pcs"},
     {id: "nvbx", nama: "Nuvo box", grosir: 187000, ecer: 10500, satuan: "dos", isi: "18 pack"},
  {id: "skll500", nama: "Soklin liquid 500", grosir: 46500, ecer: 5000, satuan: "dos", isi: "10 rtg"},
  {id: "skllrtg", nama: "Soklin lantai rtg", grosir: 100000, ecer: 4500, satuan: "dos", isi: "24 rtg"},
  {id: "skllp", nama: "Soklin lantai pouch 1000", grosir: 36500, ecer: 900, satuan: "dos", isi: "48 pouch"},
  {id: "spsl", nama: "Super sol", grosir: 89500, ecer: 4000, satuan: "dos", isi: "24 pouch"},
  {id: "tpsrbgn", nama: "Tp serbaguna 75gr", grosir: 291000, ecer: 24500, satuan: "dos", isi: "12 rtg"},
  {id: "ekmgrg", nama: "Ekomie goreng", grosir: 53500, ecer: 1500, satuan: "dos", isi: "40 pcs"},
  {id: "ekmrtg", nama: "Ekomie 3 pcs/rtg", grosir: 64000, ecer: 5500, satuan: "dos", isi: "12 rtg"},
  {id: "mss5k", nama: "Micin sasa 5000", grosir: 341000, ecer: 4500, satuan: "dos", isi: "80 bks"},
    {id: "P001", nama: "Minyak kita botol", grosir: 195000, ecer: 16500, satuan: "dos", isi: "12 botol"},
    {id: "P002", nama: "Minyak kita refil", grosir: 194000, ecer: 16500, satuan: "dos", isi: "12 pcs"},
    {id: "P003", nama: "Gula", grosir: 743000, ecer: 15500, satuan: "sak", isi: "50kg"},
    {id: "P004", nama: "Rokok Surya 12", grosir: 252000, ecer: 25500, satuan: "slop", isi: "10 bungkus"},
    {id: "skn12", nama: "Rokok sukun 12", grosir: 200000, ecer: 20000, satuan: "slop", isi: "10 bungkus"},
    {id: "skn16", nama: "Rokok sukun 16", grosir: 257000, ecer: 26000, satuan: "slop", isi: "10 bungkus"},
    {id: "skni", nama: "Rokok sukun hijau", grosir: 109000, ecer: 11000, satuan: "slop", isi: "10 bungkus"},
  {id: "dj76", nama: "Rokok djarum 76", grosir: 153000, ecer: 15500, satuan: "slop", isi: "10 bungkus"},
  {id: "djr12", nama: "Rokok djarum super", grosir: 231000, ecer: 23500, satuan: "slop", isi: "10 bungkus"},
  {id: "alm", nama: "Rokok alami", grosir: 94500, ecer: 9500, satuan: "slop", isi: "10 bungkus"},
  {id: "rkintr", nama: "Rokok inter", grosir: 496000, ecer: 25000, satuan: "slop", isi: "20 bungkus"},
  {id: "clntx", nama: "Cleantex", grosir: 178000, ecer: 12000, satuan: "dos", isi: "16 botol"},
  {id: "intmo", nama: "Intermie ori", grosir: 52500, ecer: 1400, satuan: "dos", isi: "40 bungkus"},
  {id: "intmp", nama: "Intermie pedas", grosir: 53000, ecer: 1400, satuan: "dos", isi: "40 bungkus"},
  {id: "mss", nama: "Mie sedap soto", grosir: 105000, ecer: 2700, satuan: "dos", isi: "40 bungkus"},
  {id: "msab", nama: "Mie sedap AB", grosir: 105000, ecer: 2700, satuan: "dos", isi: "40 bungkus"},
  {id: "msgr", nama: "Mie sedap GR", grosir: 110000, ecer: 2800, satuan: "dos", isi: "40 bungkus"},
  {id: "inms", nama: "Indomie soto", grosir: 109000, ecer: 2800, satuan: "dos", isi: "40 bungkus"},
  {id: "inmgr", nama: "Indomie goreng", grosir: 114000, ecer: 2900, satuan: "dos", isi: "40 bungkus"},
  {id: "mskr", nama: "Mie sedap korean", grosir: 110000, ecer: 2800, satuan: "dos", isi: "40 bungkus"},
  {id: "tptlp", nama: "Tp tulip", grosir: 166000, ecer: 7000, satuan: "sak", isi: "25kg"},
  {id: "okas", nama: "Tp oka", grosir: 170000, ecer: 7500, satuan: "sak", isi: "25kg"},
  {id: "tpckr", nama: "Tp cakra", grosir: 218000, ecer: 9000, satuan: "sak", isi: "25kg"},
  {id: "tplm", nama: "Tp lencana merah", grosir: 173000, ecer: 7500, satuan: "sak", isi: "25kg"},
  {id: "trmk", nama: "Tora moka", grosir: 189000, ecer: 16000, satuan: "dos", isi: "12 rtg"},
  {id: "ks2kmrh", nama: "Kecap sedap 2000 merah", grosir: 74000, ecer: 1600, satuan: "dos", isi: "48 pcs"},
  {id: "ks2kh", nama: "Kecap sedap 2000 hijau", grosir: 55000, ecer: 1200, satuan: "dos", isi: "48 pcs"},
  {id: "ssrtgp", nama: "Susu rtg P", grosir: 149000, ecer: 7500, satuan: "dos", isi: "20 rtg"},
  {id: "ssrtgc", nama: "Susu rtg C", grosir: 149000, ecer: 7500, satuan: "dos", isi: "20 rtg"},
  {id: "ssrtgpb", nama: "Susu rtg P+bonus", grosir: 151000, ecer: 7500, satuan: "dos", isi: "20 rtg"},
  {id: "ssrtgcb", nama: "Susu rtg C+bonus", grosir: 151000, ecer: 7500, satuan: "dos", isi: "20 rtg"},
  {id: "ryl5", nama: "Royale", grosir: 95500, ecer: 4500, satuan: "dos", isi: "24 rtg"},
  {id: "mm2k", nama: "Mama Lemon 2000", grosir: 31500, ecer: 1400, satuan: "dos", isi: "24 pcs"},
  {id: "edwr", nama: "Ekonomi cair 2000", grosir: 37500, ecer: 3500, satuan: "dos", isi: "36 pcs"},
  {id: "glda", nama: "Golda", grosir: 36000, ecer: 3500, satuan: "slop", isi: "12 botol"},
  {id: "Sdkaym", nama: "Sedap kaldu ayam", grosir: 128500, ecer: 4500, satuan: "dos", isi: "30 rtg"},
  {id: "sdpksp", nama: "Sedap kaldu sapi", grosir: 128500, ecer: 4500, satuan: "dos", isi: "30 rtg"},
  {id: "kamni", nama: "Kapal api mini", grosir: 181000, ecer: 9500, satuan: "dos", isi: "20 rtg"},
  {id: "frtn", nama: "Fortun", grosir: 217000, ecer: 18500, satuan: "dos", isi: "12 pcs"},
  {id: "bpc", nama: "Boom", grosir: 96000, ecer: 3000, satuan: "dos", isi: "36 pcs"},
  {id: "sklngm", nama: "Soklin gm", grosir: 96000, ecer: 4100, satuan: "dos", isi: "24 pcs"},
  {id: "msdpkr", nama: "Mie sedap kare", grosir: 105000, ecer: 2700, satuan: "dos", isi: "40 pcs"},
  {id: "okrs200", nama: "Oka rose 200gr", grosir: 34000, ecer: 2000, satuan: "bal", isi: "20 pcs"},
  {id: "okrs500", nama: "Oka rose 500gr", grosir: 77000, ecer: 4000, satuan: "bal", isi: "20 pcs"},
  {id: "tpbrs", nama: "Tp beras rosebrand", grosir: 130500, ecer: 7000, satuan: "dos", isi: "20 pcs"},
  {id: "tpktn", nama: "Tp ketan rosebrand", grosir: 183000, ecer: 9500, satuan: "dos", isi: "20 pcs"},
  {id: "gjhbrf12", nama: "Gajah baru filter 12", grosir: 166000, ecer: 17000, satuan: "slop", isi: "10 bungkus"},
  {id: "glgbrf12", nama: "Galang baru fiter 12", grosir: 159000, ecer: 16500, satuan: "slop", isi: "10 bungkus"},
  {id: "ec650", nama: "Ekonomi cair 650ml", grosir: 82000, ecer: 7000, satuan: "dos", isi: "12 pcs"},
  {id: "flrdn", nama: "Floridina", grosir: 30500, ecer: 3000, satuan: "dos", isi: "12 botol"},
  {id: "tsbkdm", nama: "Tisu basah kodomo", grosir: 223000, ecer: 10000, satuan: "dos", isi: "24 pcs"},
  {id: "skp320", nama: "Soklin pewangi 5000 320ml", grosir: 89500, ecer: 4000, satuan: "dos", isi: "24 pcs"},
  {id: "tgarn", nama: "Top gula aren", grosir: 198000, ecer: 17000, satuan: "dos", isi: "12 rtg"},
  {id: "kmri", nama: "Kemiri 1kg", grosir: 38000, ecer: 38000, satuan: "kg", isi: "kg"},
  {id: "sektpslp", nama: "Sek topi", grosir: 19500, ecer: 2000, satuan: "slop", isi: "10 ikat"},
  {id: "tppyg", nama: "Tp payung", grosir: 170000, ecer: 7000, satuan: "sak", isi: "25kg"},
  {id: "smprnagakr", nama: "Sampoerna aga", grosir: 156000, ecer: 16000, satuan: "slop", isi: "10 bungkus"},
  {id: "smprnaghtm", nama: "Sampoerna aga hitam", grosir: 150000, ecer: 15500, satuan: "slop", isi: "10 bungkus"},
  {id: "ryca", nama: "Royco ayam", grosir: 211000, ecer: 4500, satuan: "dos", isi: "48 rtg"},
  {id: "rycs", nama: "Royco sapi", grosir: 212000, ecer: 4500, satuan: "dos", isi: "48 rtg"},
  {id: "c1k", nama: "C1000", grosir: 159000, ecer: 5500, satuan: "dos", isi: "30 botol"},
  {id: "brbrn", nama: "Bearbrand", grosir: 283000, ecer: 9500, satuan: "dos", isi: "30 botol"},
  {id: "strla", nama: "Sterila", grosir: 15000, ecer: 15000, satuan: "dos", isi: "48 botol"},
  {id: "alal", nama: "Ale ale", grosir: 20500, ecer: 20500, satuan: "dos", isi: "24 cup"},
  {id: "onsk", nama: "Obat nyamuk sapi kecil", grosir: 241000, ecer: 4500, satuan: "dos", isi: "60 pak"},
  {id: "onsj", nama: "Obat nyamuk sapi jumbo", grosir: 271000, ecer: 5000, satuan: "dos", isi: "60 pak"},
  {id: "tmkcl", nama: "Top mini", grosir: 133000, ecer: 7000, satuan: "dos", isi: "20 rtg"},
  {id: "glrb", nama: "Gula rose brand", grosir: 328000, ecer: 17000, satuan: "bal", isi: "20 pcs"},
  {id: "tpsssrbgn", nama: "Tp sasa rtg", grosir: 120000, ecer: 8500, satuan: "dos", isi: "15 rtg"},
  {id: "dsrtg", nama: "Protex daun sirih rtg", grosir: 102500, ecer: 4500, satuan: "dos", isi: "24 rtg"},
  {id: "kmr100g", nama: "Kemiri 100gr", grosir: 4000, ecer: 4000, satuan: "gr", isi: "100gr"},
  {id: "kmr250gr", nama: "Kemiri 250gr", grosir: 10000, ecer: 10000, satuan: "gr", isi: "250gr"},
  {id: "kmri500g", nama: "Kemiri 500gr", grosir: 19500, ecer: 19500, satuan: "gr", isi: "500gr"},
  {id: "mm1/2ons", nama: "Moto mobil rtg 1/2 ons", grosir: 129000, ecer: 13000, satuan: "bal", isi: "10 rtg"},
  {id: "sntnpas", nama: "Santanpas", grosir: 111000, ecer: 9500, satuan: "dos", isi: "12 rtg"},
  {id: "indmkc", nama: "Indomilk milky kid C", grosir: 90000, ecer: 2500, satuan: "dos", isi: "40 pcs"},
  {id: "sklnpk", nama: "Soklin pk", grosir: 54000, ecer: 5000, satuan: "dos", isi: "12 rtg"},
  {id: "wowsp", nama: "Wow spageti", grosir: 112000, ecer: 14500, satuan: "dos", isi: "8 rtg"},
  {id: "bjgmrh", nama: "Bijag merah", grosir: 65000, ecer: 5500, satuan: "slop", isi: "12 pcs"},
  {id: "bjgung", nama: "Bijak ungu", grosir: 74000, ecer: 5000, satuan: "bal", isi: "15 rtg"},
  {id: "splfby", nama: "Sampo lifeboy", grosir: 170000, ecer: 4500, satuan: "dos", isi: "42 rtg"},
  {id: "lrtnklgbdk", nama: "Larutan kaleng cap badak", grosir: 123000, ecer: 5500, satuan: "dos", isi: "24 klg"},
  {id: "kcg1kg", nama: "Kacang 1kg", grosir: 28000, ecer: 28000, satuan: "kg", isi: "1kg"},
  {id: "kcg500g", nama: "Kacang 500gr", grosir: 14500, ecer: 14500, satuan: "gr", isi: "500gr"},
  {id: "kcg250g", nama: "Kacang 250gr", grosir: 7500, ecer: 7500, satuan: "gr", isi: "250gr"},
  {id: "sschc", nama: "Saos chicken", grosir: 167000, ecer: 4500, satuan: "dos", isi: "40 rtg"},
  {id: "fnt5k", nama: "Fanta 5000", grosir: 45500, ecer: 4000, satuan: "slop", isi: "12 botol"},
  {id: "sprt5k", nama: "Sprit 5000", grosir: 45500, ecer: 4000, satuan: "slop", isi: "12 botol"},
  {id: "cc5k", nama: "Coca cola 5.000", grosir: 45500, ecer: 4000, satuan: "slop", isi: "12 botol"},
  {id: "alhy", nama: "Alahya", grosir: 15000, ecer: 15000, satuan: "dos", isi: "48 gelas"}
  ];

  let keranjang = [];
  let editIndex = null; // index riwayat yang sedang diedit

  function cariProduk() {
    const input = document.getElementById("cariProduk").value.toLowerCase();
    const suggestionBox = document.getElementById("suggestions");
    suggestionBox.innerHTML = "";

    if (!input) { suggestionBox.style.display = "none"; return; }

    const hasil = produkDB.filter(p => p.id.toLowerCase().includes(input) || p.nama.toLowerCase().includes(input));

    if (hasil.length > 0) {
      hasil.forEach(p => {
        const div = document.createElement("div");
        div.className = "suggestion-item";
        div.innerHTML = `
          <div class="nama-produk">${p.nama}</div>
          <div class="harga-info">${p.satuan}: Rp ${p.grosir.toLocaleString()} | Ecer: Rp ${p.ecer.toLocaleString()}</div>
          <div class="isi-info">Isi: ${p.isi}</div>
          <span class="btn-pilih btn-dos" onclick="tambahKeranjang('${p.id}','grosir')">${p.satuan}</span>
          <span class="btn-pilih btn-ecer" onclick="tambahKeranjang('${p.id}','ecer')">Ecer</span>
        `;
        suggestionBox.appendChild(div);
      });
      suggestionBox.style.display = "block";
    } else {
      suggestionBox.style.display = "none";
    }
  }

  function tambahKeranjang(id, mode) {
    const produk = produkDB.find(p => p.id === id);
    if (!produk) return;

    const harga = mode === "grosir" ? produk.grosir : produk.ecer;
    const label = mode === "grosir" ? produk.satuan : "Ecer";

    const index = keranjang.findIndex(item => item.id === id && item.label === label);
    if (index > -1) {
      keranjang[index].qty += 1;
    } else {
      keranjang.push({...produk, qty: 1, harga, label});
    }

    renderKeranjang();
    document.getElementById("cariProduk").value = "";
    document.getElementById("suggestions").style.display = "none";
  }

  function updateQty(index, delta) {
    keranjang[index].qty += delta;
    if (keranjang[index].qty <= 0) keranjang.splice(index, 1);
    renderKeranjang();
  }

  function hapusProduk(index) {
    keranjang.splice(index, 1);
    renderKeranjang();
  }

  function renderKeranjang() {
    const tbody = document.querySelector("#keranjang tbody");
    tbody.innerHTML = "";
    let total = 0;
    keranjang.forEach((p, i) => {
      const subtotal = p.harga * p.qty;
      total += subtotal;

      tbody.innerHTML += `
        <tr>
          <td>
            <div>${p.nama}</div>
            <div style="font-size:12px;color:#6b7280;">
              ${p.label} @ Rp ${p.harga.toLocaleString()}
            </div>
          </td>
          <td>
            <div class="qty-control">
              <button class="btn-qty" onclick="updateQty(${i},-1)">-</button>
              ${p.qty}
              <button class="btn-qty" onclick="updateQty(${i},1)">+</button>
            </div>
          </td>
          <td>Rp ${subtotal.toLocaleString()}</td>
          <td><button onclick="hapusProduk(${i})">X</button></td>
        </tr>`;
    });
    document.getElementById("total").innerText = total.toLocaleString();
    hitungKembalian();
  }

  function hitungKembalian() {
    const total = parseInt(document.getElementById("total").innerText.replace(/\./g,'')) || 0;
    const bayar = parseInt(document.getElementById("uangPembeli").value) || 0;
    const kembali = bayar - total;
    document.getElementById("kembalian").innerText = kembali >= 0 ? kembali.toLocaleString() : "0";
  }

  function bukaRiwayat() {
    document.getElementById("riwayatModal").style.display = "flex";
    renderRiwayat();
  }

  function tutupRiwayat() {
    document.getElementById("riwayatModal").style.display = "none";
  }

  function renderRiwayat() {
    const tbody = document.querySelector("#tabelRiwayat tbody");
    tbody.innerHTML = "";
    let riwayat = JSON.parse(localStorage.getItem("riwayatOrder")) || [];

    riwayat.forEach((r, i) => {
      let detail = r.items.map(p => `${p.qty}x ${p.nama} (${p.label})`).join("<br>");
      tbody.innerHTML += `
        <tr>
          <td>${r.tanggal}</td>
          <td>Rp ${r.total.toLocaleString()}</td>
          <td>${detail}</td>
          <td>
            <button class="aksi-btn edit-btn" onclick="editRiwayat(${i})">Edit</button>
            <button class="aksi-btn hapus-btn" onclick="hapusRiwayat(${i})">Hapus</button>
          </td>
        </tr>`;
    });
  }

  function editRiwayat(index) {
    let riwayat = JSON.parse(localStorage.getItem("riwayatOrder")) || [];
    if (!riwayat[index]) return;

    keranjang = [...riwayat[index].items];
    renderKeranjang();

    editIndex = index;
    tutupRiwayat();

    alert("Orderan dimuat ke keranjang, silakan edit lalu cetak ulang.");
  }

  function hapusRiwayat(index) {
    let riwayat = JSON.parse(localStorage.getItem("riwayatOrder")) || [];
    riwayat.splice(index, 1);
    localStorage.setItem("riwayatOrder", JSON.stringify(riwayat));
    renderRiwayat();
  }

  function simpanRiwayat(order) {
    let riwayat = JSON.parse(localStorage.getItem("riwayatOrder")) || [];
    if (editIndex !== null) {
      riwayat[editIndex] = order;
      editIndex = null;
    } else {
      riwayat.push(order);
    }
    localStorage.setItem("riwayatOrder", JSON.stringify(riwayat));
  }

  async function cetakNota() {
    const encoder = new TextEncoder();
    let esc = "\x1B";
    let nota = esc+"@";
    nota += esc+"a"+String.fromCharCode(1);
    nota += "WPA SHOP\n";
    nota += "WA : 0852 3480 3820\n";
    nota += esc+"a"+String.fromCharCode(0);
    nota += "-----------------------------\n";

    keranjang.forEach(p => {
      nota += `${p.nama.substring(0,30)}\n`;
      nota += `${p.qty} x ${p.harga.toLocaleString()} (${p.label})`;
      nota += `= Rp ${(p.harga * p.qty).toLocaleString()}\n`;
    });

    nota += "-----------------------------\n";
    nota += "TOTAL : Rp "+document.getElementById("total").innerText+"\n";
    nota += "BAYAR : Rp "+(document.getElementById("uangPembeli").value || 0)+"\n";
    nota += "KEMBALI: Rp "+document.getElementById("kembalian").innerText+"\n";
    nota += "-----------------------------\n";
    nota += esc+"a"+String.fromCharCode(1);
    nota += "Terima Kasih\n\n\n\n";

    // Simpan ke riwayat
    const order = {
      tanggal: new Date().toLocaleString(),
      items: [...keranjang],
      total: parseInt(document.getElementById("total").innerText.replace(/\./g,'')) || 0,
      bayar: parseInt(document.getElementById("uangPembeli").value) || 0,
      kembali: parseInt(document.getElementById("kembalian").innerText.replace(/\./g,'')) || 0
    };
    simpanRiwayat(order);

    try {
      const device = await navigator.usb.requestDevice({ filters: [{}] });
      await device.open();
      if (device.configuration === null) await device.selectConfiguration(1);
      const iface = device.configuration.interfaces[0];
      await device.claimInterface(iface.interfaceNumber);
      let endpointOut = null;
      iface.alternates[0].endpoints.forEach(ep => { if (ep.direction === "out") endpointOut = ep.endpointNumber; });
      if (endpointOut === null) throw new Error("Endpoint OUT tidak ditemukan");
      const data = encoder.encode(nota);
      await device.transferOut(endpointOut, data);
      alert("Nota berhasil dicetak via USB!");
    } catch (err) {
      alert("Gagal mencetak: " + err);
    }
  }
</script>

</body>
</html>
